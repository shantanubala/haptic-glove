(function(){CNB.Registration=new Class({Implements:[Options,Events],options:{appId:'187',siloId:'3',editionId:'2',regSource:'',callback:'CNB.Reg',text:{haveErrors:'There appears to be some errors.',inuseUserName:'This Username is already in use.',availableUserName:'This Username is available.',inuseEmail:'This Email is already in use.',newEmail:'Please enter a new Email.',pwShort:'Your Password must be at least 8 characters.',wrongEmailPw:'That Email and Password combination do not match our records.',wrongEmail:'That Email is not in our records.',passwordSent:'Your Password reminder has been sent.',passwordChanged:'Your Password has been changed.',noChangesMade:'You have not made any changes.',userUpdated:'Your information has been updated.',emailUpdated:'You must verify your new Email by clicking on the link included in an email we\'ve just sent you.',verifyIdentity:'Please verify your Email and Password.',dobTooYoung:'You must be at least 13 years old to make an account.'}},initialize:function(options){this.setOptions(options);this.addEvents({'loggedIn':this.setLoggedIn,'updateDisplay':this.updateStatusDisplay,'confirmUser':this.confirmUser,'initBehavior':this.tracking,'explicityLoggedIn':this.externalCookies.pass('login',this),'loggedOut':this.externalCookies.pass('logout',this)});window.addEvent('domready',function(){this.fireEvent('initBehavior');this.gate()}.bind(this))},load:function(){this.loadSession()},loadSession:function(){var purs=CNB.Cookie.get('purs_3');var surs=CNB.Cookie.get('surs_3');var cnb_user=JSON.decode(Cookie.read('cnb_user'));var cnb_reg_s=CNB.Cookie.get('cnb_reg_s');if($chk(cnb_user)){CNB.UserVars.extend({'userName':cnb_user.userName,'email':cnb_user.email,'rememberMe':cnb_user.rememberMe})}if($chk(purs)&&($chk(surs)||CNB.UserVars.get('rememberMe')=='true')){CNB.UserVars.extend({'permToken':purs,'sessToken':surs});if($chk(cnb_reg_s)){CNB.UserVars.set('sessionId',cnb_reg_s)}this.fireEvent('loadSession');this.fireEvent('loggedIn')}},updateDisplay:function(){if(!CNB.isDomReady){window.addEvent('domready',function(){this.fireEvent('updateDisplay')}.bind(this))}else{this.fireEvent('updateDisplay')}},controlClick:function(options){if($defined(options)&&$defined(options.e)){e=new Event(options.e).stop();delete options.e}},getSessionId:function(){var s=Cookie.read('cnb_reg_s');return($chk(s))?s:null},authenticate:function(options){this.setOptions(options);var blocks=this._build_logIn();var f=blocks.build;f.addEvent('submit',function(){this.activeForm=f}.bind(this));f.addEvent('submit',this._api_authenticate.bind(this));this.layer=new CNB.Layered([blocks.notify,f.cont],{title:'<span class="decor">Log</span> In',className:'framed layer-reg layer-reg-login',width:'-',maxHeight:false});f.addEvent('submitStart',this.layer.loading.bind(this.layer,'start'));f.addEvent('error',this.layer.loading.bind(this.layer,'stop'));this.fireEvent('logInFormLoad')},logIn:function(options){this.controlClick(options);this.addEvent('authenticate',this.fireEvent.pass('explicityLoggedIn',this));this.addEvent('authenticate',this.fireEvent.pass('loggedIn',this));this.addEvent('authenticate',this.fireEvent.pass('executeBehavior',this));this.authenticate()},logOut:function(options){this.controlClick(options);var itp='itp_s'+CNB.env.cookieHost.replace(/\./g,'-');['purs_3','surs_3','aurs_3','cnb_user','cnb_reg_s',itp].each(function(el){Cookie.dispose(el,{domain:CNB.env.cookieHost,path:'/'})}.bind(this));this.fireEvent('loggedOut');window.location.reload()},join:function(options){this.controlClick(options);this.setOptions(options);var blocks=this._build_join();var f=blocks.build;f.addEvent('submit',function(){this.activeForm=f}.bind(this));f.addEvent('submit',this._api_createUser.bind(this));this.layer=new CNB.Layered([blocks.notify,f.cont,blocks.supplement],{title:'<span class="decor">Join</span> '+CNB.env.title,className:'framed layer-reg layer-reg-join',width:'-',maxHeight:false});f.addEvent('submitStart',this.layer.loading.bind(this.layer,'start'));f.addEvent('error',this.layer.loading.bind(this.layer,'stop'));this.checkUserName(f);this.fireEvent('joinFormLoad',f)},forgotPassword:function(){var blocks=this._build_forgotPw();var f=blocks.build;f.addEvent('submit',function(){this.activeForm=f}.bind(this));f.addEvent('submit',this._api_sendPassword.bind(this));this.layer=new CNB.Layered([blocks.notify,f.cont],{title:'<span class="decor">Forgot</span> Password',className:'framed layer-reg layer-reg-forgot',width:'-'});f.addEvent('submitStart',this.layer.loading.bind(this.layer,'start'));f.addEvent('error',this.layer.loading.bind(this.layer,'stop'))},isSessionActive:function(){var s=CNB.Cookie.get('cnb_reg_s');return($chk(s))?true:false},manageAccount:function(options){this.controlClick(options);if(!this.isSessionActive()){this.addEvent('logInFormLoad',this.addNotify.bind(this,this.options.text.verifyIdentity));this.addEvent('authenticate',this.manageAccount.bind(this));this.authenticate();return false}var tab=($defined(options)&&$defined(options.tab))?options.tab:0;var blocks=this._build_manageAccount();var f=blocks.build1;f.addEvent('submit',function(){this.activeForm=f}.bind(this));f.addEvent('submit',this._api_updateUser.bind(this));var f2=blocks.build2;f2.addEvent('submit',function(){this.activeForm=f2}.bind(this));f2.addEvent('submit',this._api_changePassword.bind(this));this.layer=new CNB.Layered([blocks.notify,blocks.hed,f.cont,f2.cont],{title:'<span class="decor">Manage</span> Account',className:'framed layer-reg layer-reg-manage',width:'-',maxHeight:false,onComplete:function(){var s=new CNB.Selector(this.content.getElements('#selector-reg li'),this.content.getElements('.select-box'),{setCookie:false,startSeq:tab})}});f.addEvent('submitStart',this.layer.loading.bind(this.layer,'start'));f2.addEvent('submitStart',this.layer.loading.bind(this.layer,'start'));var state=new CNB.InputState({'inputs':f.cont.getElements('.input'),'editable':true}).set();this.checkUserName(f);this.fireEvent('manageFormLoad',f,f2)},_api_authenticate:function(options){var params=$merge({'appId':this.options.appId,'editionId':this.options.editionId,'email':'','password':'','rememberMe':'false'},options);this.callApi('rps/authenticate',this._cb_authenticate,params)},_cb_authenticate:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}var sessionId=($defined(r.User.SessionId))?r.User.SessionId['$']:'dev';CNB.UserVars.extend({'userName':r.User.UserName['$'],'regId':r.User.RegistrationId['$'],'sessToken':r.User.SessToken['$'],'permToken':r.User.PermToken['$'],'email':r.User.EmailAddress['$'],'rememberMe':r.User.RememberMe['$'],'sessionId':sessionId});this.setCookies(['sessToken','permToken','cnb_user','cnb_reg_s']);this.fireEvent('authenticate')},_api_createUser:function(opts){var options=this.formatOptions(opts);var params=$merge({'appId':this.options.appId,'regSource':this.options.regSource,'userName':'','email':'','password':'','rememberMe':'false'},options);CNB.UserVars.extend({'email':params.email,'userName':params.userName,'rememberMe':params.rememberMe});this.callApi('rps/createUser',this._cb_createUser,params)},_cb_createUser:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}var sessionId=($defined(r.Receipt.SessionId))?r.Receipt.SessionId['$']:'dev';CNB.UserVars.extend({'regId':r.Receipt.RegistrationId['$'],'permToken':r.Receipt.Session.PermToken['$'],'sessToken':r.Receipt.Session.SessToken['$'],'sessionId':sessionId});this.setCookies(['sessToken','permToken','cnb_user','cnb_reg_s']);this.fireEvent('createUser');this.fireEvent('loggedIn');this.fireEvent('confirmUser')},_api_sendPassword:function(options){var params=$merge({'appId':this.options.appId,'email':''},options);this.callApi('rps/sendPassword',this._cb_sendPassword,params)},_cb_sendPassword:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}this.fireEvent('sendPassword');this.layer.replace(this.options.text.passwordSent);if($defined(this.layer)){this.layer.loading('stop')}},_api_changePassword:function(options){var params=$merge({'appId':this.options.appId,'regId':CNB.UserVars.get('regId'),'oldPassword':'','newPassword':'','newPasswordConf':''},options);this.callApi('rps/changePassword',this._cb_changePassword,params)},_cb_changePassword:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}this.fireEvent('changePassword');this.activeForm.validate.errorMessage(this.options.text.passwordChanged,true);this.activeForm.form.getElements('.input').each(function(el){el.set('value','')});if($defined(this.layer)){this.layer.loading('stop')}},checkUserName:function(f){var input=($defined(f.fields['userName']))?f.fields['userName']:f.fields['newUserName'];input.addEvent('blur',function(){this.activeForm=f;this._api_checkUserName(input)}.bind(this))},_api_checkUserName:function(input){var val=input.get('value');if($chk(val)&&(CNB.UserVars.get('userName')!=val)){var params={'siloId':this.options.siloId,'userName':val};this.callApi('rps/checkUserName',this._cb_checkUserName,params)}else{this.activeForm.validate.clearInput(input)}},_cb_checkUserName:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){CNB.log(r.Status.Error);return false}var input=($defined(this.activeForm.fields['userName']))?this.activeForm.fields['userName']:this.activeForm.fields['newUserName'];if(r.IsUserNameTaken['$']=='true'){this.activeForm.validate.errorInput(input,this.options.text.inuseUserName)}else{this.activeForm.validate.clearInput(input)}},_api_updateUser:function(opts){var options=this.formatOptions(opts);var params=$merge({'appId':this.options.appId,'sessionId':CNB.UserVars.get('sessionId'),'regId':CNB.UserVars.get('regId'),'email':CNB.UserVars.get('email')},options);this.newEmail=($defined(params.newEmail))?params.newEmail:null;this.newUserName=($defined(params.newUserName))?params.newUserName:null;this.callApi('rps/updateUser',this._cb_updateUser,params)},_cb_updateUser:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}if($chk(this.newEmail)){CNB.UserVars.set('email',this.newEmail);this.fireEvent('confirmUser')}if($chk(this.newUserName)){CNB.UserVars.set('userName',this.newUserName)}this.activeForm.validate.errorMessage(this.options.text.userUpdated,true);if($defined(this.layer)){this.layer.loading('stop')}this.setCookies('cnb_user');this.fireEvent('updateUser')},_api_sendClcEmail:function(){var params={'appId':this.options.appId,'regId':CNB.UserVars.get('regId')};this.callApi('rps/sendClcEmail',this._cb_sendClcEmail,params)},_cb_sendClcEmail:function(data){var r=data.RpsResponse;if(r.Status['@state']=='failed'){this.errors(r.Status.Error);return false}this.fireEvent('sendClc')},formatOptions:function(opts){var options={};var newsletters='';var dob={};$each(opts,function(val,key){if(val.contains('INTERNAL_')){newsletters+=val+','}else if(key.contains('dob')){dob[key]=val}else{options[key]=val}});if($chk(newsletters)){options['options']=newsletters}if($defined(dob.dobMonth)){if($chk(dob.dobMonth)&&$chk(dob.dobDay)&&$chk(dob.dobYear)){options['dateOfBirth']=dob.dobMonth+'/'+dob.dobDay+'/'+dob.dobYear}}return options},setLoggedIn:function(){if($chk(this.layer)){this.layer.close('fade')}CNB.UserVars.set('loggedIn',true);this.updateDisplay()},setCookies:function(cookies){var setCnbUser=function(){Cookie.write('cnb_user',JSON.encode({'userName':CNB.UserVars.get('userName'),'email':CNB.UserVars.get('email'),'rememberMe':CNB.UserVars.get('rememberMe')}),{duration:1000,domain:CNB.env.cookieHost,path:'/'})};var setCnbSession=function(){if($chk(CNB.UserVars.get('sessionId'))){CNB.Cookie.set('cnb_reg_s',CNB.UserVars.get('sessionId'),.010415,CNB.env.cookieHost)}};var setSessToken=function(){if($chk(CNB.UserVars.get('sessToken'))){CNB.Cookie.set('surs_3',CNB.UserVars.get('sessToken'),null,CNB.env.cookieHost)}};var setPermToken=function(){if($chk(CNB.UserVars.get('permToken'))){CNB.Cookie.set('purs_3',CNB.UserVars.get('permToken'),1000,CNB.env.cookieHost)}};$splat(cookies).each(function(name){switch(name){case'cnb_user':setCnbUser();break;case'sessToken':setSessToken();break;case'permToken':setPermToken();break;case'cnb_reg_s':setCnbSession();break}})},externalCookies:function(action){if(this.options.appId=='218'){var qs=Hash.toQueryString({'action':action,'series':'0','userName':CNB.UserVars.get('userName'),'email':CNB.UserVars.get('email'),'rememberMe':CNB.UserVars.get('rememberMe'),'permToken':CNB.UserVars.get('permToken'),'sessToken':CNB.UserVars.get('sessToken'),'sessionId':CNB.UserVars.get('sessionId')});var iframe=new Element('iframe',{'src':'http://membership.bnet.com/html/bnet/misc/reg-cookies.html?'+qs,'frameborder':'0','marginheight':'0','marginwidth':'0','scrolling':'no','styles':{'width':'0','height':'0','border':'0'}}).inject($(document.body),'bottom')}},confirmUser:function(){this.confirmNotify=new Element('div',{'class':'msg-notify','html':'<h4>You must confirm your Email!</h4><p>To fully activate your free '+CNB.env.title+' membership, you must verify your e-mail address by clicking on the link included in an email we\'ve just sent to: <span class="email">'+CNB.UserVars.get("email")+'</span></p><p>Entered the wrong Email? <a onclick="'+this.options.callback+'.manageAccount()">Update your e-mail address</a>.</p>'});this.confirmSteps='<li><span>1.</span> Go to your e-mail account.</li>'+'<li><span>2.</span> Check your Inbox for an e-mail from membership@noreply.itpapers.com with the subject "<em>Action Required: '+CNB.env.title+' Membership Activation</em>". If you don\'t see this e-mail in your inbox it may have been mistakenly flagged as spam and placed in your Junk E-Mail mail folder.'+'<li><span>3.</span> Click on the account confirmation link within this e-mail to confirm your '+CNB.env.title+' account.';this.fireEvent('confirmBuild');var hed=new Element('h4',{'text':'Next Steps'});var steps=new Element('ul',{'class':'reg-next-steps','html':this.confirmSteps});var supplement=new Element('p',{'class':'msg-supplement','html':'If you are unable to locate this message in either the Inbox or Junk E-Mail mail folders, please <a href="'+CNB.env.helpUrl+'" target="_blank">contact our customer support</a>.'});var btnLevel=new Element('p',{'class':'msg-continue'});var continueBtn=new Element('a',{'class':'btn btn-submit btn-continue close','text':'Continue'}).inject(btnLevel,'bottom');this.layer=new CNB.Layered([this.confirmNotify,hed,steps,supplement,btnLevel],{title:'Activate your '+CNB.env.title+' Account',className:'framed layer-reg layer-reg-confirm',maxHeight:false,width:'-'});this.layer.addEvent('close',function(){this.fireEvent('executeBehavior')}.bind(this))},updateStatusDisplay:function(){var status=$$('.reg-status');status.each(function(el){if(el.hasClass('reg-status-gen')){var html;if(CNB.UserVars.get('loggedIn')===true){var loggedTxt=($chk(CNB.UserVars.get('userName')))?'Logged In as '+CNB.UserVars.get('userName'):'Logged In';html='You are currently: '+loggedTxt+' | <a class="reg-login" onclick="'+this.options.callback+'.logOut();">Log Out</a>'}else{html='You are currently: a Guest | <a class="reg-login" onclick="'+this.options.callback+'.logIn({regSource: \'talkback-login\'});">Log In</a>'}el.empty().set('html',html)}else if(el.hasClass('reg-status-login')){var html;if(CNB.UserVars.get('loggedIn')===true){html='<a onclick="'+this.options.callback+'.manageAccount();">Manage account</a> - <a onclick="'+this.options.callback+'.logOut();">Log Out</a>'}else{html='<a onclick="'+this.options.callback+'.logIn({regSource: \'header-login\'});">Log In</a>'}el.empty().set('html',html)}else if(el.hasClass('reg-status-login-standard')){var html;if(CNB.UserVars.get('loggedIn')===true){html='<a onclick="'+this.options.callback+'.logOut();">Log Out</a> | <a onclick="'+this.options.callback+'.manageAccount();">My Account</a>'}else{html='<a onclick="'+this.options.callback+'.logIn({regSource: \'header-login\'});">Log In</a>'}el.empty().set('html',html)}}.bind(this))},addNotify:function(msg){if($('msg-notify-alert')){$('msg-notify-alert').destroy()}var a=new Element('p',{'id':'msg-notify-alert','html':'<b>'+msg+'</b>'}).inject(this.layer.content.getElement('.msg-notify'),'top')},gate:function(){var setRegSource=function(el){var o=el.get('jsonClass');this.options.regSource=($chk(o))?o.source:''}.bind(this);$$('.reg-gated').each(function(el){if(el.get('tag')=='a'){el.addEvent('click',function(e){if(CNB.UserVars.get('loggedIn')===false){e=new Event(e).stop();this.addEvent('logInFormLoad',this.addNotify.bind(this,'Please Log In to access this page.'));this.addEvent('executeBehavior',function(){window.location=el.get('href')});setRegSource(el);this.logIn()}}.bind(this))}if(el.get('tag')=='form'){el.addEvent('submit',function(e){if(CNB.UserVars.get('loggedIn')===false){e.stop();var submitForm=function(){el.submit()};this.addEvent('logInFormLoad',this.addNotify.bind(this,'You must be logged in to post your comment.'));this.addEvent('executeBehavior',submitForm);setRegSource(el);this.logIn()}}.bind(this))}}.bind(this))},_build_forgotPw:function(){var z={};z.build=new CNB.FormBuilder({id:'reg-pw',className:'reg-form',fieldsets:{id:'reg-pw-user',fields:{name:'email',type:'text',label:'Email:',className:'input required email'}},buttons:[{'text':'Send Password',type:'submit','className':'btn btn-submit btn-send'}]});z.desc=new Element('p',{'class':'msg-description','text':''});z.notify=new Element('div',{'class':'msg-notify','html':'<p>Please enter you email and we will send you your password.</p>'});return z},_build_logIn:function(){var z={};z.build=new CNB.FormBuilder({id:'reg-login',className:'reg-form',fieldsets:{id:'reg-login-user',fields:[{name:'email',type:'text',label:'Email:',className:'input required email'},{name:'password',type:'password',label:'Password:',className:'input required'},{name:'rememberMe',type:'checkbox',label:'Remember my e-mail and password for automatic login.',value:'true',checked:'true'}]},buttons:[{text:'Log In',type:'submit',className:'btn btn-submit btn-log-in'}]});z.notify=new Element('div',{'class':'msg-notify','html':'<p>Not a member of one of these brands? <a onclick="'+this.options.callback+'.join();">Join Now</a>.</p><div class="cnb-logos png">BNET, ZDNet, TechRepublic, MoneyWatch.com, SmartPlanet</div>'});z.supplement=new Element('p',{'class':'msg-supplement msg-forgot-pw','html':'<a onclick="'+this.options.callback+'.forgotPassword();">Forgot Your Password?</a>'}).inject(z.build.cont,'bottom');return z},_build_join:function(){var z={};var nlFields=[];switch(CNB.env.site){case'zdnet':nlFields=[{name:'e580',type:'checkbox',label:'New products, discounts and special offers from our premier enterprise sponsors',value:'e580:INTERNAL_NEWSLETTER',checked:'true'},{name:'e590',type:'checkbox',label:'ZDNet\'s White Paper Membership Newsletter',value:'e590:INTERNAL_NEWSLETTER',checked:'true'},{name:'e589',type:'checkbox',label:'ZDNet\'s Must-Read News Alerts',value:'e589:INTERNAL_NEWSLETTER',checked:'true'},{name:'e539',type:'hidden',value:'e539:INTERNAL_NEWSLETTER',checked:'true'},{name:'e550',type:'hidden',value:'e550:INTERNAL_NEWSLETTER',checked:'true'}];break;case'smartplanet':nlFields=[{name:'e660',type:'hidden',value:'e660:INTERNAL_NEWSLETTER',checked:'true'}];break;case'bnet':nlFields=[{name:'e843',type:'hidden',value:'e843:INTERNAL_NEWSLETTER',checked:'true'},{name:'e713',type:'hidden',value:'e713:INTERNAL_NEWSLETTER',checked:'true'}];break;case'moneywatch':nlFields=[{name:'e661',type:'checkbox',label:'CBS MoneyWatch Must Reads',value:'e661:INTERNAL_NEWSLETTER',checked:'true'}];break}z.build=new CNB.FormBuilder({id:'reg-short',className:'reg-form',fieldsets:[{id:'reg-short-user',className:'sub-col1 col-sub-1',legend:'User Information',fields:[{name:'userName',type:'text',label:'Username:',className:'input specialchars required'},{name:'password',type:'password',label:'Password:',className:'input required password'},{name:'confirm',type:'password',label:'Confirm Password:',className:'input required password confirm-pw'},{name:'email',type:'text',label:'Email Address:',className:'input required email'},{name:'rememberMe',type:'checkbox',label:'Remember my e-mail and password for automatic login.',value:'true',checked:'true'}]},{id:'reg-short-nl',className:'sub-col2 col-sub-2 reg-nl',legend:'Newsletters',fields:nlFields}],buttons:[{text:'Join',type:'submit',className:'btn btn-submit btn-join'}]});if(CNB.env.site=='zdnet'||CNB.env.site=='moneywatch'){new Element('h5',{'id':'reg-short-nl-hed','text':'I\'d also like to receive the following newsletters:'}).inject(z.build.fieldsets['reg-short-nl'],'top')}new Element('p',{'id':'reg-short-user-hed','class':'msg-supplement msg-note','text':'All fields required unless noted'}).inject(z.build.form,'before');var tosCopy='<b>Terms of Service</b> - ';switch(CNB.env.site){case'zdnet':tosCopy+='As a ZDNet registrant, you will receive a complimentary subscription to the ZDNet\'s Tech Update Today and ZDNet Announcements newsletters. You may unsubscribe from these newsletters at any time.';break;case'smartplanet':tosCopy+='As a SmartPlanet registrant, you will receive a complimentary subscription to SmartPlanet\'s weekly newsletter. You may unsubscribe from this newsletter at any time.';break;case'bnet':tosCopy+='As a BNET registrant, you will receive occasional e-mails about important BNET news and site changes and a complimentary subscription to the BNET member newsletter, The BNET Report.';break;case'moneywatch':tosCopy+='As a MoneyWatch registrant, you will receive occasional e-mails about important MoneyWatch news and site change.';break}tosCopy+='By using this service, you indicate that you agree to our <a href="http://www.cnetnetworks.com/editorial/terms.html" target="_blank">Terms and Conditions</a> and have read and understand our <a href="http://www.cnetnetworks.com/editorial/privacy.html" target="_blank">Privacy Policy</a>.';z.supplement=new Element('p',{'id':'reg-short-terms','class':'msg-supplement msg-terms','html':tosCopy});z.notify=new Element('div',{'class':'msg-notify','html':'<p>Already have an account with these brands? <a onclick="'+this.options.callback+'.logIn();">Log In Now</a>.</p><div class="cnb-logos png">BNET, ZDNet, TechRepublic, MoneyWatch.com, SmartPlanet</div>'});return z},_build_manageAccount:function(){var z={};z.hed=new Element('ul',{'id':'selector-reg','class':'select-default clear'});var hed1=new Element('li',{'html':'<a>Update Info</a>'}).inject(z.hed,'bottom');var hed2=new Element('li',{'html':'<a>Change Password</a>'}).inject(z.hed,'bottom');z.build1=new CNB.FormBuilder({id:'reg-manage-userinfo',className:'reg-form select-box',fieldsets:{fields:[{name:'newUserName',type:'text',label:'Username:','value':CNB.UserVars.get('userName'),className:'input required'},{name:'newEmail',type:'text',label:'Email:','value':CNB.UserVars.get('email'),className:'input required email'}]},buttons:[{text:'Change Email',type:'submit',className:'btn btn-submit btn-update'}]});z.build2=new CNB.FormBuilder({id:'reg-manage',className:'reg-form select-box',fieldsets:{fields:[{name:'oldPassword',type:'password',label:'Old Password:',className:'input required'},{name:'newPassword',type:'password',label:'New Password:',className:'input required password'},{name:'newPasswordConf',type:'password',label:'Confirm New Password:',className:'input required password confirm-pw'}]},buttons:[{text:'Change Password',type:'submit',className:'btn btn-submit btn-update'}]});z.supplement=new Element('p',{'class':'msg-supplement msg-forgot-pw','html':'<a onclick="'+this.options.callback+'.forgotPassword();">Forgot Your Password?</a>'}).inject(z.build2.cont,'bottom');var profileUrl='';var nlUrl='';switch(CNB.env.site){case'zdnet':profileUrl='http://membership.zdnet.com/1341-4-44.html';nlUrl='http://nl.zdnet.com/acct_mgmt.sc?brand=zdnet';break;case'smartplanet':profileUrl='http://membership.smartplanet.com/1341-4-213.html';nlUrl='http://nl.smartplanet.com/acct_mgmt.sc?brand=smartplanet';break;default:profileUrl='http://membership.bnet.com/1341-4-45.html';nlUrl='http://nl.bnet.com/acct_mgmt.sc?brand=bnet'}z.notify=new Element('div',{'class':'msg-notify','html':'<h6>More management options:</h6><ul class="tyte"><li><a href="'+profileUrl+'?path='+document.location+'" target="_blank">Full membership profile</a></li><li><a href="'+nlUrl+'" target="_blank">Manage your newsletters</a></li>'});return z},callApi:function(resource,callback,params){var jsonp=new Request.JSONP({url:CNB.env.apiURS+resource+'/',data:$merge(params,{apiKey:CNB.env.cnbApiKey,viewType:'json'}),onComplete:callback.bind(this),onFailure:this._apiFail.bind(this)}).send()},tracking:function(){var ping=function(cval){if($chk(cval)){CNB.DW.ping({ctype:'ria;evt;objtyp;obj',cval:cval})}};this.addEvent('explicityLoggedIn',ping.pass('shortreg;success;rps-api;login'));this.addEvent('loggedOut',ping.pass('shortreg;success;rps-api;logout'));this.addEvent('sendClc',ping.pass('shortreg;success;rps-api;send-clc-email'));this.addEvent('createUser',ping.pass('shortreg;success;rps-api;create-user'));this.addEvent('sendPassword',ping.pass('shortreg;success;rps-api;send-password'));this.addEvent('changePassword',ping.pass('shortreg;success;rps-api;change-password'));this.addEvent('updateUser',ping.pass('shortreg;success;rps-api;update-user'));this.addEvent('apiFail',ping.pass('shortreg;fail;api;api-failed'));this.addEvent('logInFormLoad',ping.pass('shortreg;view;popup;login'));this.addEvent('joinFormLoad',ping.pass('shortreg;view;popup;create-user'));this.fireEvent('initTracking')},_apiFail:function(){CNB.log('apifailed');if($defined(this.layer)){this.layer.loading('stop')}this.fireEvent('apiFail');this.activeForm.validate.errorMessage('We have encountered a technical problem. Please try submitting the form again, or logging in at the <a href="http://www.zdnet.com/1320-4_24-44.html?path='+document.location+'">Members Log In page</a>.')},errors:function(response){if($defined(this.layer)){this.layer.loading('stop')}$splat(response).each(function(el){try{switch(el['@applicationCode']){case'login_error.email_password':this.activeForm.validate.errorMessage(this.options.text.wrongEmailPw);break;case'inuse.userName':this.activeForm.validate.errorInput(this.activeForm.fields['userName'],this.options.text.inuseUserName);break;case'missing.userName':break;case'inuse.email':var emailInput=($defined(this.activeForm.fields.email))?this.activeForm.fields['email']:this.activeForm.fields['newEmail'];this.activeForm.validate.errorInput(emailInput,this.options.text.inuseEmail);break;case'invalid.emailaddress':this.activeForm.validate.errorInput(this.activeForm.fields['email'],this.options.text.wrongEmail);break;case'tooshort.password':this.activeForm.validate.errorInput(this.activeForm.fields['password'],this.options.text.pwShort);break;case'dateofbirth.dobtooyoung':this.activeForm.validate.errorMessage(this.options.text.dobTooYoung);break;default:if($defined(this.activeForm)){this.activeForm.validate.errorMessage(el.ErrorMessage['$'])}}}catch(e){CNB.log(e)}}.bind(this))}});var options={};switch(CNB.env.site){case'zdnet':options={'appId':'187'};break;case'smartplanet':options={'appId':'217'};break;default:options={'appId':'218'}}CNB.Reg=new CNB.Registration(options);CNB.Reg.load()})();